**ñTestsñaroundñañ"new"ñfloating-point*ñrepresentationñwhichñisñrelatively*ñcompactñandñfast.**ñ=====================================**ñFormat:**ñSñEEEEEEEñNNNNNNNN.NNNNNNNNñNNNNNNNN*ñS=SIGN*ñE=EXPO+64,ñEXPO=-63..63ñE>0*ñN=24-bitñunsignedñnumber**ñ=====================================**ñRepresents*óxñ=ñSñ*ñ256**(E-64)ñ*ñ(N/65536.0)**ñ+0ñisñ(S=0,E=0),ñegñMSB=$00*ñ-0ñisñ(S=1,E=0),ñbutñisñtreatedñasñ+0**ñ=====================================**ñ(c)ñSamuelñDEVULDERñ-ñAprilñ2019**ñinspiredñby*õhttp://tinyurl.com/yxng3vau**ñ=====================================*ñConventions:*ñ=====================================*ñFloating-pointñoperationsñareñstack-*ñbasedñ(registerñUñisñused).ñComments*ñindicatesñstack-valuesñlikeñthis:*ü(beforeñ--ñafter)**ñForñspeedñreason,ñfloatingñpoint*ñoperationsñtypicallyñtrashñtheñA*ñandñBñregistersñandñpossiblyñtheñX*ñregisterñasñwell.ñConsiderñthem*ñasñdirtyñwhenñcalling.ñSameñwith*ñCC-flags.*ñ=====================================øorgõ$9000DO9õsetõ0DO8õsetõ0DO7õsetõ0DO6õsetõ0DO5õsetõ0DO4õsetõ0DO3õsetõ0DO2õsetõ0DO1õsetõ0DO0õsetõ0DOPUSHòMACROøIFNEôDO9STACKñOVERFLOWøENDCDO9õsetõDO8DO8õsetõDO7DO7õsetõDO6DO6õsetõDO5DO5õsetõDO4DO4õsetõDO3DO3õsetõDO2DO2õsetõDO1DO1õsetõ\0øENDMDOPOPóMACROøIFEQôDO1STACKñUNDERFLOWøENDCDO1õsetõDO2DO2õsetõDO3DO3õsetõDO4DO4õsetõDO5DO5õsetõDO6DO6õsetõDO7DO7õsetõDO8DO8õsetõDO9DO9õsetõ0øENDMDOGENóMACROôIFò\0øIFEQô(\0&7)-0øDOGENó(\0<-3),\1,\2,\30øENDCøIFEQô(\0&7)-1øDOGENó(\0<-3),\1,\2,\31øENDCøIFEQô(\0&7)-2øDOGENó(\0<-3),\1,\2,\32øENDCøIFEQô(\0&7)-3øDOGENó(\0<-3),\1,\2,\33øENDCøIFEQô(\0&7)-4øDOGENó(\0<-3),\1,\2,\34øENDCøIFEQô(\0&7)-5øDOGENó(\0<-3),\1,\2,\35øENDCøIFEQô(\0&7)-6øDOGENó(\0<-3),\1,\2,\36øENDCøIFEQô(\0&7)-7øDOGENó(\0<-3),\1,\2,\37øENDCôELSEø\1ö\2,\3ôENDCøENDMDOSET1òMACRO\0ösetõ\1øENDMDOSET2òMACRO\1ösetõ\0øENDMDOSETóMACROøIFöDO1øDOGENóDO1,DOSET1,REDO,DOENTøDOGENóDO1,DOSET1,EXIT,DOLVEøENDCøIFöDO2øDOGENóDO2,DOSET1,EXIT2,DOLVEøDOGENóDO2,DOSET1,REDO2,DOENTøENDCøIFöDO3øDOGENóDO3,DOSET1,EXIT3,DOLVEøDOGENóDO3,DOSET1,REDO3,DOENTøENDCøENDMDOöMACRO*ñDODO0õSETõDO0+1øDOPUSHòDO0øDOGENóDO1,DOSET2,*,DOENTøDOSETøENDMDONEôMACRO*ñDONEøDOGENóDO1,DOSET2,*,DOLVEøDOPOPøDOSETøENDMLOOPóMACRO*ñLOOPþIFNEó'l-'\0þbraûREDOþELSEþjmpûREDOþENDCþDONEþENDMBREAKòMACRO*ñBREAKþIFNEó'l-'\0þbraûEXITþELSEþjmpûEXITþENDCþDONEþENDMDOb_eqñMACROþ\1bneò\0þENDMDOb_neñMACROþ\1beqò\0þENDMDOb_miñMACROþ\1bplò\0þENDMDOb_plñMACROþ\1bmiò\0þENDMDOb_vsñMACROþ\1bvcò\0þENDMDOb_vcñMACROþ\lbvsò\0þENDMDOb_csñMACROþ\1bccò\0þENDMDOb_ccñMACROþ\1bcsò\0þENDMDOb_gtñMACROþ\1bleò\0þENDMDOb_leñMACROþ\1bgtò\0þENDMDOb_geñMACROþ\1bltò\0þENDMDOb_ltñMACROþ\1bgeò\0þENDMDOb_hiñMACROþ\1blsò\0þENDMDOb_lsñMACROþ\1bhiò\0þENDMDOb_hsñMACROþ\1bloò\0þENDMDOb_loñMACROþ\1hsó\0þENDMWHILEòMACRO*ñWHILEþDOþDOb_\0ñREDO,\1þENDMUNTILòMACRO*ñUNTILþDOb_\0ñREDO,\1þDONEþENDMDOIFóMACRO*ñDOIFþDOþDOb_\0ñEXIT,\1þENDMDOELSEñMACRO*ñDOELSEDO1ûSETûDO1+1þDOGENóDO1,DOSET1,EXIT,DOþBREAKò\0DO1ûSETûDO1-1þDOGENóDO1,DOSET2,*,DOLVEDO1ûSETûDO1+1øENDMDOELIFñMACRO*ñDOELIFþDOELSEñ\1þDOb_\0ñEXIT,\1øENDMòldbñ#0òDOIFñcc÷clraòDOELSE÷orccó#1òDONEòENDJPöMACROþechoñsautñenñ$\0øIFEQô(\0-*-2)&$FF80*øbraõ\0ò;ñbranchementsñposiþfcbû$20,\0-*-2øELSEøIFEQô(*+1-\0)&$FF80*øbraõ\0ò;ñbranchementsñnegaþfcbû$20,*+2-\0øELSEøjmpõ\0øENDCøENDCøENDMJPIFôMACROøIFEQô(((*+1-\1)+128)<-15)*2+(øb\0õ\1øELSEølb\0ô\1øENDCøENDM*ñ=====================================*ñStackñmanipulation*ñ=====================================*ñ(ñañbñcñ--ñcñañbñ)fprot_òbsrõfpswapò;ñañcñbøleauô4,uõ;ñañcñ(b)øbsrõfpswapò;ñcñañ(b)øleauô-4,uô;ñcñañbørts*ñ(ñañbñcñ--ñbñcñañ)fprotóleauô4,uõ;ñañbñ(c)øbsrõfpswapò;ñbñañ(c)øleauô-4,uô;ñbñañcøbraõfpswapò;ñbñcña*ñ(ñañbñ--ñbñañbñ)fptuckòbsrõfpswapò;ñbñaøbraõfpoverò;ñbñañb*ñ(ñañbñ--ñbñ)fpnipóleaxô,uøleauô8,uøbraõfpldx*ñ(ñañbñ--ñ)fp2dropñbsrõfpdrop*ñ(ñañ--ñ)fpdropòleauô4,uørts*ñ(ñañbñ--ñbñañ)fpswapòlddõ6,uøldxõ2,uøstdõ2,uøstxõ6,uølddõ4,uøldxõ,uøstdõ,uøstxõ4,uørts*ñ(ña0ñ..ñanñ--ña1ñ..ñanña0ñ)fprollòpulsôx÷;ñnñisñnextñinstøldbõ,x+õ;ñnotice:ñnñUNSIøpshsôx÷;fprollbñpshsôu÷;ñreferenceñptrøbsrõfppickbñ;ña0ñ..ñanña0øleauô4,xfproll1ñlddõ-8,uô;ñrecopyøldxõ-6,uøpshsôd,xøcmpuô,søbneõfproll1øpulsôu,pc*ñ(ña0ñ..ñanñ--ña0ñ..ñanña0ñ)fppickòpulsôx÷;ñnñisñnextñinstøldbõ,x+õ;ñnotice:ñnñUNSIøpshsôx÷;fppickbñleaxô,uö;ñnñisñB-regøabxý;ñX+nøabxý;ñX+2nøabxý;ñX+3nøabxý;ñX+4nøbraófpldxù;ñloadñx*ñ(ñañbñ--ñañbñañbñ)fpover2ñbsrñfpover*ñ(ñañbñ--ñañbñañ)fpoveròleaxô4,uõ;ñpointñtoñ2ndñføfcbõ$CCõ;ñSKIP2ñ(LDDñ#N)*ñ(ñañ--ñañañ)fpdupóleaxô,uö;ñpointñtoñTOS*ñ=====================================*ñLoad/Storeñoperations*ñ=====================================*ñ(ñ--ñ@Xñ)òpushñfloatñatñXñontoñstackfpldxólddõ2,xõ;ñgetñlowñmantisøpshuôd÷;ñpushñontoñstacølddõ,xö;ñgetñexp+hiñmanøpshuôd÷;ñpushñontoñstacørtsý;ñdone*ñ(ñ--ñ@Sñ)ñcopyñfloatñfromñS-stackfpldsóleaxô,søbsrõfpldxøleasô4,sørts*ñ(ñañ--ñ)ñcopyñTOSñontoñS-stackfpstsóleasô-4,søleaxô,s*ñ(ñañ--ñ)ñcopyñTOSñvalueñatñXfpstxópuluôd÷;ñgetñexpo+mant.østdõ,xö;ñstoreñatñxøpuluôd÷;ñgetñmant/østdõ2,xõ;ñstoreñatñx+2ørts*ñ(ñ--ñDñ)ñloadñañfloatñfromñDñ(unsignedfpldduòtstaü;ñD<=256ñ?øbeqõfpldbu1ñ;ñnoñ=>ñgeneraløclrõ,-uõ;òclearñLSBøpshuôd÷;òsetñMSWøldaõ#$41ô;òexpoñ=ñ1østaõ,-uõ;òsetñexponentørtsý;ñdone*ñ(ñ--ñ0ñ)fpld0óclraøclrbøpshuôdøpshuôdørts*ñ(ñ--ñBñ)ñloadñañfloatñfromñBñ(unsignedfpldbóclrafpldbu1ñstaõ,-uõ;ñyesñ==>ñ"smalløstaõ,-uõ;òclearñLSWøtstbü;òisñzeroñ?øbeqõfpldbu2ñ;ôyesñ=>ñcleaøldaõ#$40ô;ônoñ=>òexpofpldbu2ñpshuôd÷;ñsetñexpoñ&ñMSBørtsý;ñdone*ñ(ñ--ñimm8ñ)ñloadñañfloatñfromñimmediatfpld8ópulsôxøldbõ,x+øpshsôxøsexøbraõfpldd*ñ(ñ--ñimm16ñ)ñloadñañfloatñfromñimmediafpld16òpulsôxølddõ,x++øpshsôx*ñ(ñ--ñDñ)ñloadñañfloatñfromñDñ(signed)fplddótstaøbgeõfplddu+1ønegaü;ñ!ønegbü;ñnegdøsbcaô#0ö;ñ!øbsrõfpldduøbraõfpneg*ñ(ñañ--ñ)ñD=trunc(a)ñVñflagñisñsetñinñcfpstdóldaõ,uö;ñgetñexponentølslaü;ñgetñridñofñsigøbmiõfpstd1ò;ñexpo<$40ñ?øclraü;ñyesñ==>ñ(floatøclrbü;óD=0øbraõfpstd0ò;ódonefpstd1òcmpaô#$41*2ò;ñnoñ==>ñcheckñeøbccõfpstd4ò;ñyesñ:ñoverflowølslaü;ñnoò:ñexpo==0øbneõfpstd3ò;ñnoò=>ñfloat=xøldbõ1,uõ;ñyesñ=>ñfloat=xfpstd2òtstõ,uö;ñfloat<0ñ?øbplõfpstd0ò;ñnoñ=>ñdoneønegaü;ñnegateñDønegbü;ñ!øsbcaô#0ö;ñ!fpstd0òjmpõfpdropò;ñfixñstackñ&ñrefpstd3òlddõ1,uõ;ñgetñxxyyøbplõfpstd2ò;ñxxyyñisñ15bitsfpstd4òlddõ#$7fffò;ñnoñ=>ñoverflowøoraõ,uö;ñupdateñsignøorccô#2ö;ñflagñV=1øbraõfpstd0*ñ=====================================*ñComparison*ñ=====================================*ñ(ñañ--ñañ)ñflagsñ=ñsign(a)fptstóldaõ,uö;ñgetñexpoølslaü;ñmoveñsign-bitøbeqõfptst0ò;ñ==0ñ?ñyes=>donøroraü;ñgetñsignñbitñbfptst0òrtsý;ñdone*ñ(ñañbñ--ñañbñ)ñflagsñ=ñsign(a-b)fpcmpóldaõ4,uøeoraô,uö;ñcompageñsignøbplõfpcmp1ò;ñsameñ?øldaõ4,uõ;ñnoñ=>ñsign(a-børtsý;ñdonefpcmp1òbsrõcmpmagò;ñorderñinvertedøtfrõcc,bô;ñnegativeñnumbeøldaõ,uö;ñgetñsignøbplõfpcmp2ò;ñnegativeñ?øeorbô#$08ô;ñyesñ=>ñN=~Nfpcmp2òtfrõb,ccô;ñnoò=>ñNñunchaørts*ñcompareñnumñbyñmagnitudeñ(signñignored*cmpmagòlddõ4,uõ;ñgetñexpoñ&ñMS*øsubaô,uö;ñcompareñexpo*ølslaü;ñgetñridñofñsi*øbneõcmpmag1ñ;ñexpoñdifferñ=cmpmagñldaû,uþlslaþstaû,-sþlddû4,uþlslaþsubaó,s+þbneûcmpmag0øsubbô1,uõ;ñsameñexpoñ=>ñcøbneõcmpmag0ñ;ñMSBñdifferñ=>ølddõ6,uõ;ñcompareñLSWøsubdô2,ucmpmag0ñrtscmpmag1÷lslaþrts*ñ=====================================*ñArithmeticñoperations*ñ=====================================*ñ(ñañ--ñañ)fpabsóldaõ#$7Fô;ñsign-bitñclearøandaô,uö;ñclearñsignñbitøbraõfpzer0ò;ñupdateñexponen*ñ(ñañ--ñ-añ)fpnególdaõ,uö;ñgetñexpoølslaü;ñclearñsign-bitøbeqõcmpmag0ñ;ñ==0ñ?ñyes=>donøroraü;ñgetñsign-bitñbøeoraô#$80ô;ñinvert-itøbraõfpzer0ò;ñupdateñexponen*ñ(ñañbñ--ña-bñ)fpsubóbsrõfpneg*ñ(ñañbñ--ña+bñ)fpaddóbsrõcmpmagò;ñbñ<ñañ?øbhsõfpadd1ò;ñyesñ=>ñokøjsrõfpswapò;ñnoñ=>ñputñsmalfpadd1òldaõ,uö;ñgetñsmallestñeøleauô4,uõ;ñprepareñstackøandaô#127ô;ñisñsmallestñnuøbeqõfpadd0ò;ñyesò=>ñdoneþnegaøaddaô,uö;ñcompareñmagnitøandaô#127øbeqõfpadd4ò;ñsameñ==>ñdoñadødecaü;ñ1ñorderñofñdiføbneõfpadd2ò;ñnoñ=>ñskipølddõ-3,uô;ñyesñ=>ñshiftñ1øclrõ-3,uô;ñXXñYYñZZñ-->ñ0øbraõfpadd3ò;ñfinishñshiftinfpadd2òdecaü;ñ>ñ2ñordersñoføbneõfpadd0ò;ñyesñ=>ñthenñnoøclraü;ñnoñ=>ñshiftñ2østaõ-3,uô;ñXXñYYñZZñ-->ñ0øldbõ-2,uô;fpadd3òstdõ-2,uô;ñupdateñlowerñmfpadd4òldaõ-4,uô;ñgetñsignøeoraô,uö;ñbothñsignñequaøbmiõdosubó;ñnoñ==>ñsubtracølddõ2,uõ;ñproperñadditioøadddô-2,uô;ñaddñLSWøstdõ2,uõ;ñstoreñLSWølddõ1,uõ;ñgetñMSBñ(+ñmidøadcaô-3,uô;ñaddñMSBøbccõfpadd5ò;ñextrañbyteñreqøincõ,uö;ñyesñ=>ñexponenøbeqõfpovfó;ñ01111111ñ+1ñ?øbvsõfpovfó;ñ11111111ñ+1ñ?østdõ2,uõ;ñshiftñLSWøldaõ#1ö;ñputñcarryñinñMfpadd5òstaõ1,uõ;ñupdateñMSBfpadd0òrtsý;ñdonedosubólddõ2,uõ;ñproperñsubtracøsubdô-2,uô;ñsubtractñLSWøstdõ2,uõ;øldaõ1,uõ;ñthenñMSBøsbcaô-3,uô;øbneõfpadd5ò;ñstillñnormalizølddõ2,uõ;ñnoñ=>ñrenormaløbeqõfpzer0ò;ñLSW=0ñ?ñ=>ñyesøstdõ1,uõ;ñnoñ=>ñshiftñmaølddõ#$7f00ò;ñsign-maskødecõ,uö;ñexpo=expo-1øandaô,uö;ñunderflowñ?øbeqõfpzer0ò;ñyesñ=>ñresult=østbõ3,uõ;ñclearñLSBøbraõfpadd0ò;ñdonefpzeroòclraü;ñmakeñresult=0fpzer0òstaõ,uö;ñexp=0ørts*ñ(ñañbñ--ña%bñ)fpmodójsrõfpover2ñ;ñañbñañbøbsrõfpdivó;ñañbña/bøjsrõfptruncñ;ñañbñtrunc(a/b)øbsrõfpmuló;ñañb*trunc(a/b)øbraõfpsubó;ña-b*trunc(a/b)fpovfólddõ#$ffffò;ñmakeñresultñ=østdõ2,uõ;ñmaxñLSWølsraü;ñA=$7FFFøoraõ,uö;ñinsertñsign-biøstdõ,uö;ñupdateñMSWørts*ñ(ñañ--ñ1/añ)ñ1/añisñobtainedñbyñiteratfpinvóldaõ,uö;ñgetñexponentøandaô#$7fô;ñclearñsignøsubaò#2ù;ñbiased-exponeøbcsõfpovfó;÷yesò=>ølddõ,uö;ñgetñexponentñ+þeoraó#$80ó;ñ-aþstaû,uþeoraó#$3fó;ñnegateñexpþdecaÿò;ñsubþeoraó#$C0ó;ñinvertñsigøpshuôd÷;ñpushñLSW+optimøpshuôd÷;ñ-añxfpinv2òjsrõfpover2ñ;ñ-añxñ-añxøbsrõfpmuló;ñ-añxñ-x*aøjsrõfpld8ó;ñ-añxñ-x*añ2øfcbõ2øjsrõfpaddó;ñ-añxñ2-x*aøjsrõfpoverò;ñ-añxñ2-x*añxøbsrõfpmuló;ñ-añxñx*(2-x*a)øbsrõchkchgò;ñ-añxñ~1/añ--ñ-øbneõfpinv2ò;ñxñ!=ñ~1/añ?ñyeøjmpõfpnipó;ñ-añ1/aô--ñ1*ñ(ñañbñ--ñbñ)ñZ=1ñiffña==bchkchgòpuluôd,xõ;ñgetñHI/LOøcmpdô,uö;ñHI(a)==HI(b)ñ?øbneõchkchg1ñ;ñnoñ=>ñcopyøcmpxô2,uõ;ñLO(a)==LO(b)ñ?øbeqõchkchg2ñ;ñyesñ=>ñdoneñ(Zchkchg1ñstdõ,uö;ñcopyñHIøstxõ2,uõ;ñcopyñLOøldaõ#1ö;ñensureñZ==0chkchg2ñrts*ñ(ñañbñ--ña/bñ)fpdivóbsrõfpinvó;ña/bñisña*(1/b)*ñ(ñañbñ--ña*bñ)fpmulóldaõ,uö;ña=num2ñexpoøleauô4,uõ;ñupdateñstackñpøldbõ,uö;ñb=num1ñexpoølslaü;ñnum2=0ñ?øbeqõfpzer0ò;ñyesñ=>ñresult=ølslbü;ñnum1=0ñ?øbeqõfpzeroò;ñyesñ=>ñresult=øsubaô#$80ô;ñunbiasñexponenøsubbô#$80østaõ,-sõ;ñcomputeñexponeøaddbô,s+õ;ñoverflowñ?øbvcõfpmul1ò;ñnoñ=>ñprocessøbmiõfpovfó;ñyesñ&ñexpo>0øjmpõfpzeroò;ñyesñ&ñexpo<=0*ñPartialñproductsñsumsñareñencodedñinña*ñcontainsñpairsñofñoffsetsñ(a,b)ñwhich*ñfollow:*òa>0ó=>ñaddña-offsetñ*ñb-offsetñtoñp*òa=b=0ñ=>ñshiftñpartialñproduct*òa<0ó=>ñdone**ñU-stackñrelativeñindices*ú1,ñ2,ñ3*ù-3,-2,-1*ñpartialñproducts*÷1*-3*ú2*-3*ý3*-3*ú1*-2*ý2*-2*ÿñ3*-2ô<==ñbootstrap*ý1*-1*ÿñ2*-1*ÿô3*-1ñ<==ñignoredñ(fifpmultbñfcbõ2,-1,0,0øfcbõ3,-3,2,-2,1,-1,0,0øfcbõ2,-3,1,-2,0,0øfcbõ1,-3øfcbõ-1fpmul1òaddbô#$80ô;ñaddñbiasøstbõ,-sõ;ñsaveñexponentøldbõ,uö;ñgetñnum2ñexpoøeorbô-4,uô;ñxorñnum1ñexpoølslbü;ñputñsignñinñC-øldbõ,s+õ;ñrestoreñexponeørorbü;ñputñsign-bitñiøstbõ,uö;ñupdateñresult'øldaõ3,uõ;ñbootstrapñwithøldbõ-2,uømuløstdõ-8,uô;ñignoreñ-6,-5.øclrõ-9,uô;ñnextñshiftsøldxõ#fpmultbfpmul2òlddõ,x++fpmul3òldaõa,uõ;ñimplementñpartøldbõb,uømuløbeqõfpmul4ò;ñproduct==0ñ=>øadddô-8,uøstdõ-8,uøldaõ#0øadcaô-9,uøstaõ-9,ufpmul4òlddõ,x++øbgtõfpmul3ò;ñcode>0ñ=>ñnextøbltõfpmul5ò;ñcode<0ñ=>ñdoneølddõ-7,uô;ñcode=0ñ=>ñshiføstdõ-6,uølddõ-9,uøstdõ-8,uøclrõ-9,uøbraõfpmul2fpmul5òlddõ-8,uô;ñgetñHIñvalueøtstaü;ñextrañbyteñneeøbneõfpmul6ò;ñyesñ=>ñshiftøstbõ1,uõ;ñnoñ==>ñwriteñMølddõ-6,uô;ñgetñLSWøstdõ2,uõ;ñputñLSWørtsý;ñdonefpmul6òstdõ1,uõ;ñshiftñresultøldbõ-6,uô;ñfetchñlsbøstbõ3,uõ;ñstoreñlsbøincõ,uö;ñincrementñexpoøbeqõfpmul7ò;ñ11111111ñ+1ñ(Cøbvsõfpmul7ò;ñ01111111ñ+1ñ(Cørtsý;ñdonefpmul7òlddõ#$FFFFò;ñmakeñitñmaxøstdõ2,uõ;ñwriteñLSWøroraü;ñbutñsign-backøstdõ,uö;ñwriteñMSWfpmul8òrts*ñ(ñañ--ñsqrt(a)ñ)fpsqrtòldaõ,uö;ña<=0ñ?øbleõfpmul8ò;ñyesñ=>ñdoneøsubaô#$40ô;ñremoveñbiasøasraü;ñexpo/2øoraõ#1ö;ñguardñagainstøaddaô#$40ô;ñaddñbiasøldbõ#1ö;ñprepareñmantisøpshuôd÷;ñxñ=ñ~sqrt(256^øpshuôd÷;ñañxfpsqrt1ñjsrõfpover2ñ;ñañxñañxøjsrõfpdivó;ñañxña/xøjsrõfpoverò;ñañxña/xñxøjsrõfpaddó;ñañxñ(a/x+x)øjsrõfp_d2ó;ñañxñ(a/x+x)/2øjsrõchkchgò;ñchangedñ?øbneõfpsqrt1ñ;ñañxøjmpõfpnipó;ñx*ñ(ñañ--ña/2ñ)ñfast!fp_d2ólddõ,uö;ñgetñexponentñ+ølslaü;ñnum==0ñ?øbeqõfp_d21ò;ñyesñ=>ñdoneølsrbü;ñrightñshiftñmsøbeqõfp_d22ò;ñzeroñ=>ñnormaløstbõ1,uõ;ñalreadyñnormalørorõ2,uõ;ñshiftñlsbørorõ3,uõ;ñshiftñlsbfp_d21òrtsý;ñdonefp_d22òlddõ2,uõ;ñloadñmsbøroraü;ñintroduceñcarrørorbøstdõ1,uõ;ñshiftñmsbøldaõ#0øroraü;ñinjectñcarryøstaõ3,uõ;ñupdateñlsbødecõ,uö;ñdecrementñexpoøldaõ,uølslaü;ñunderflowñ?øbneõfp_d23ò;ñnoñ==>ñdoneøstaõ,uö;ñyesñ==>ñresultfp_d23òrts*ñ(ñañ--ñ2*añ)ñfast!fp_m2óldaõ,uö;ñgetñexponentølslaü;ñnum=0ñ?øbeqõfp_m20ò;ñyesñ=>ñdoneølslõ3,uõ;ñshiftñmantissaørolõ2,uørolõ1,uøbcsõfp_m21ò;ñneedñextrañbytfp_m20òrtsý;ñnoñ=>ñdonefp_m21òlddõ1,uõ;ñyesñ=>ñshiftñmøstdõ2,uøldaõ#1østaõ1,uõ;ñdoneñmantissaøincõ,uö;ñincreaseñexpooøbeqõfp_m22ò;ñ11111111ñ+1ñ==øbvsõfp_m22ò;ñ01111111ñ+1ñ==ørtsfp_m22òjmpõfpovf*ñ(ñañ--ñtrunc(a)ñ)ñremoveñfractionnalñdfptruncñclrbü;ñpreloadñBñwithøldaõ,uö;ñgetñexponentølslaü;ñgetñridñofñsigøbmiõfptrnc1ñ;ñexpo<$40ñ?østbõ,uö;òyesñ==>ñresulørtsfptrnc1ñcmpaô#$82øbccõfptrnc3ñ;ñexpo>=2ñ=>ñalrølslaü;ò(getñridñofñmøbneõfptrnc2ñ;ñnoñ=>òfloat=xøstbõ2,uõ;ñyesñ=>ñfloat=xfptrnc2ñstbõ3,uõ;ñclearñzzfptrnc3ñrts*ñ(ñañ--ña**nñ)ñnñisñinñB-regñ(signed)fppowbòstbõ,-sõ;ñstoreñnøbgeõfppowb1ønegõ,sö;ñ-nøjsrõfpinvó;ñ1/afppowb1ñjsrõfpld8ó;ñañ1øfcbõ1øbraõfppowb4fppowb2ñjsrõfpoverò;ñañbñaøjsrõfpmuló;ñañb*afppowb3ñjsrõfpswapò;ñb*añaøjsrõfpdupó;ñb*añañaøjsrõfpmuló;ñb*aña*aøjsrõfpswapò;ña*añb*afppowb4ñlsrõ,søbcsõfppowb2øbneõfppowb3øleasô1,søjmpõfpnipó;ñb*añfinished*ñ(ñañ--ñ10*añ)ñfastfp_m10òjsrõfpdupó;ñañaøbsrõfp_m2ó;ñaña*2øbsrõfp_m2ó;ñaña*4øjsrõfpaddó;ña*5øbraõfp_m2ó;ña*10*ñ=====================================*ñread/write*ñ=====================================*ñ(ñ--ñ<parsedñfloat>ñ)ñx=stringñptrñ(upfpatofòpshsôyøleayô,xøbsrõfpatof0ñ;ñnøldbõ,yøcmpbô#'.øbneõfpatof1øleayô1,yøbsrõfpatof2øldbõ,yfpatof1ñcmpbô#'eõ;ñn.nnnnøbeqõfpatof3øcmpbô#'Eøbneõfpatof6fpatof3ñleayô1,yøjsrõfpld8ó;ñn.nnnñ10øfcbõ10øbsrõfpatof0ñ;ñn.nnnñ10ñexpoøjsrõfpstdó;ñn.nnnñ10ñD=expøcmpdô#-127øbgeõfpatof4ølddõ#-127fpatof4ñcmpdô#127øbleõfpatof5ølddõ#127fpatof5ñbsrõfppowbò;ñn.nnnñ10^expoøjsrõfpmuló;ñn.nnn*10^exp‹fpatof6ñleaxô,yøpulsôy,pcfpatoi2ñldbõ,s+õ;ñwasñ'-'ñpresenøbneõfptrnc3ñ;ñnoñ=>ñdoneøjmpõfpnegó;ñyesñ=>ñnegate*ñparseñanñintñpointedñbyñyfpatof0ñjsrõfpld0ó;ñ0øldbõ,yö;ñgetñsign-charøstbõ,-sõ;ñstoreñitñonñstøcmpbô#'+øbeqõfpatof9øcmpbô#'-õ;ñnegativeñ?øbneõfpatofañ;ñnoò=>ñ",s"ñ!=øclrõ,sö;ñyesñ=>ñ",s"ñ==fpatof9ñleayô1,yõ;ñadvancefpatofañldbõ,yö;ñnøsubbô#'0øbcsõfpatoi2øcmpbô#10øbccõfpatoi2øbsrõfp_m10ò;ñ10*nøldbõ,y+øsubbô#'0øjsrõfpldbó;ñ10*nñbøjsrõfpaddó;ñ10*n+bøbraõfpatofafptenthñfdbõ$3f19,$999a*ñparseñfractionnalfpatof2ñjsrõfpld0ó;ñxñ0øldxõ#fptenthøjsrõfpldxó;ñxñ0ñ0.1øldaõ8,uõ;ñgetñsignñofñxøandaô#$80ô;ñisolateñsignñoøoraõ,uö;ñcopyñsignñtoñ0østaõ,uö;ñxñ0ñ+-0.1fpatof7ñldbõ,yö;ñxñfñ+-0.1ñgetøsubbô#'0õ;ñ<=ñ'0'ñ?øbcsõfpatof8ñ;ñyesñ=>ñdoneøcmpbô#10õ;ñ>ñ'9'ñ?øbccõfpatof8ñ;ñyesñ=>ñdoneøjsrõfpswapò;ñxñ+-0.1ñføjsrõfpoverò;ñxñ+-0.1ñfñ+-0.øldbõ,y+õ;ñgetñcharñ(agaiøsubbô#'0õ;ñconvertñasciiøjsrõfpldbó;ñxñ+-0.1ñfñ+-0.øjsrõfpmuló;ñxñ+-0.1ñfñ+-0.øjsrõfpaddó;ñxñ+-0.1ñf.digiøjsrõfpswapò;ñxñf.digitñ+-0.øldxõ#fptenthøjsrõfpldxó;ñxñf.digitñ+-0.øjsrõfpmuló;ñxñf.digitñ+-0.øbraõfpatof7ñ;ñloopfpatof8ñjsrõfpdropò;ñxñføjmpõfpaddó:ñx+f*ñ(ñ--ñ<parsedñint>ñ)ñx=ptrñtoñstringñ(ufpatoiòpshsôyøleayô,xøbsrõfpatof0øleaxô,yøpulsôy,pc*ñwriteñinñstingñpointedñbyñyñtheñhexñnufphex2òbsrõfphex1fphex1òldaõ#$10ømuløADDAô#$90øDAAøADCAô#$40øDAAøSTAõ,y+ørts*ñ(ñañ--ñ)ñwriteñfloatingñpointñinñhexñn*úinñasciiñatñxñ(updated)fpftohòpshsôyøleayô,xøldaõ,uølslaøbneõfptoh1øldaõ#'0østaõ,y+fptoh0òleaxô,yøpulsôyøjmpõfpdropfptoh1òlddõ#32+256*'+øbccõfptoh2øldaõ#'-fptoh2òstdõ,y++øldaõ#'$østaõ,y+øldbõ1,uøbsrõfphex2øldaõ,uøandaô#127øsubaô#$42ø;ñexpo=$42ñ=øbeqõfptoh24øincaÿñ;ñexpo=$41ñ=øbeqõfptoh16ølddõ2,uøbeqõfptoh3øldbõ#'.østbõ,y+øldbõ2,uøbsrõfphex2øldbõ3,uøbsrõfphex2fptoh3òldbõ,uølslbøsubbô#$80ø;ñnoñexponenøbeqõfptoh0ö;ñdoneøldaõ#32østaõ,y+øldaõ#'+øtstbøbgeõfptoh4øldaõ#'-ønegbfptoh4òstaõ,y+øldaõ#'$østaõ,y+ølsrbfptoh5òbsrõfphex2øbraõfptoh0fptoh24ñldbõ2,uøbsrõfphex2øldbõ3,uøbraõfptoh5fptoh16ñldbõ2,uøbsrõfphex2øldbõ3,uøbeqõfptoh0øldaõ#'.østaõ,y+øbraõfptoh5*ñ=====================================*ñinteractiveñcalculator*ñ=====================================mainôldxú#timerø;ñactþstxû$6027*ýstxû$6021þldaû$6019þoraû#32þstaû$6019þlduõ#fpstackøldxõ#welcomeøjsrõputsø;ñprintsñmesloopôjsrõstksizeõ;ñbuildñpromøjsrõitoa8÷;ñconvertñstøldxõ#linebufô;ñtoñdecimaløjsrõprhex2ö;ñprintñ2ñdiølddõ#32+256*'>ò;ñaddñ'>ñ'østdõ,x++øclrõ,xøjsrõloadbuføjsrõputsø;ñprintñpromøjsrõgetsø;ñreadsñañnoøbsrõtrimø;ñskipñspaceøldbõ,xøbeqõloopø;ñemptyñstriøldyõ#cmds÷;ñscanñtheñløbsrõscancmdøldbõ,yú;ñfoundñsomeøbplõdoExecö;ñyesñ=>ñexeøpshsôxû;ñnoñ=>ñtryøjsrõfpatoføcmpxô,s++ø;ñparsedñsomøbneõloopø;ñyesñ=>ñokøjsrõfpdropö;ñnoò=>ñcanøldxõ#redofroô;ñputsñanñerøjsrõprintlnøbraõloopscancmdñpshsôxû;ñsaveñbuffescanc1òldbõ,x+ù;ñreadñbuffeøbeqõscanc3ö;ñnoñmoreñ?øcmpbô#'Aøbloõscanc2ö;ñ<ñ'A'ñ?øcmpbô#'Zøbhiõscanc2ö;ñ>ñ'Z'ñ?øaddbô#'a-'Aö;ñmakeñlowerscanc2òcmpbô,y+ù;ñcompareñwiøbeqõscanc1ö;ñmatchñ=>ñcøleayô-1,yø;ñcancelñy+scanc3òldbõ-1,xøbneõscanc4ö;ñ"x"ñnotñfiøldbõ,yøcmpbô#10øbhsõscanc4ö;ñ"y"ñnotñfiøpulsôx,pcø;ñdoneñ(founscanc4òldbõ,y+ù;ñreadñuptoøcmpbô#10øbhsõscanc4øleayô2,yù;ñskipñaddrøpulsôxøldbõ,yú;ñnextñentryøbplõscancmdõ;ñyesñ==>ñreørtsÿò;ñallñdonedoExecòldxõ#loopøpshsôxøjsrõstksizeøldxõ#beepstrøcmpbô,y+øbloõputsøjmpõ[,y]doTimeExecþldbû-1,y÷DOþbeqôEXITþdecbþstbû,-sþldbû-1,yþdecbþjsrûfppickbþldbû,s+÷LOOPñlþclraþstdûtimeþldbû#100þstbû,-s÷DOþjsrû[,y]þdecû,s÷WHILEñne*ñtrimñspacesñatñbothñendsñofñstringñpoitrimôpshsôx,yøleayô,xtrim1óldbõ,y+øbeqõtrim2øcmpbô#32øblsõtrim1trim2óleayô-1,ytrim3óldbõ,y+østbõ,x+øbneõtrim3trim4óldbõ,-xøcmpbô#32øbhiõtrim5øcmpxô,søbhsõtrim4trim5óclrõ1,xøpulsôx,y,pc*ñconvertñBñintoñdecimalitoa8ópshsôbølddõ#8itoa81òlslõ,søstaõ,-søadcaô,s+ødaaødecbøbneõitoa81østaõ,søpulsôb,pc*ñreturnsñtheñfp-stackñlengthñinñregñDstksizeñpshsôuølddõ#fpstackøsubdô,s++ølsraørorbølsraørorbørts*ñprintñañnumberñinñhexñ(2ñdigits)ñinñxprhex2òpshsôyøleayô,xøjsrõfphex2øleaxô,yøpulsôy,pc*ñloadñtheñlinebufñintoñxloadbufñldxõ#linebuførts*ñprintsñañlineñpointedñbyñxprlnbufñbsrõloadbufprintlnñbsrõputsøldxõ#crlf*øbraõputsøfcbõ$CCõ;ñSKIP2ñ(LDDñ#N)*ñprintsñañnul-terminatedñstringputs0óbsrõputcputsôldbõ,x+øbneõputs0ørts*ñreadsñañnul-terminatedñstringñinñlinebgetsôbsrõloadbufgets2ójsrõ$E806øtstbøbeqõgets2øcmpbô#13øbeqõgets0øcmpbô#8ö;ñbacksp‚ceøbeqõgets1øcmpbô#32øbloõgets2øcmpbô#127øbhsõgets2øcmpxô#lineend-1øbhsõgets3østbõ,x+øbsrõputcøbraõgets2gets3óldbõ#7ú;ñbeepøbsrõputcøbraõgets2gets1ócmpxô#linebuføbeqõgets2øleaxô-1,xøldbõ#8øbsrõputcøldbõ#32øbsrõputcøldbõ#8øbsrõputcøbraõgets2gets0óclrõ,xøldxõ#crlføbsrõputsøbraõloadbufputcôjmpõ$E803doDotóbsrõloadbufõ;ñdisplayflodoDot2òjsrõfpftohøclrõ,xøbsrõloadbuføbraõprintlndoDotS÷jsrõstksize÷stbû,-s÷DOþbeqûEXITþdecbþstbû,-sþcombþaddbó1,søjsrõitoa8øbsrõloadbufõ;ñtoñdecimaløjsrõprhex2ö;ñprintñ2ñdiølddõ#32+256*':ò;ñaddñ':ñ'østdõ,x++øldbõ,sþpshsóxøjsrõfppickbþpulsóxøbsrõdoDot2øldbõ,s+÷LOOP÷pulsób,pctimer÷DOþincûtime+1þbneûEXITþincûtime÷DONE÷JMPô$E830timeófdbû0cmdsôfccõ/./ù;ñnameøfcbõ1û;ñartiryñ<ñ1øfdbõdoDot÷;ñexecñaddrøfccõ/.s/øfcbõ0øfdbõdoDotSøfccõ/+/øfcbõ2øfdbõfpaddøfccõ/-/øfcbõ2øfdbõfpaddøfccõ/*/øfcbõ2øfdbõfpmuløfccõ%/%øfcbõ2øfdbõfpdivøfccõ/sqrt/øfcbõ1øfdbõfpsqrtøfccõ/dup/øfcbõ1øfdbõfpdupøfccõ/drop/øfcbõ1øfdbõfpdropøfccõ/over/øfcbõ2øfdbõfpoverøfcbõ-1ö;ñendñofñcmdswelcomeñfccõ/RPNñcalc/crlfôfcbõ10,13,0redofroñfccõ/?Redoñfromñstart/beepstrñfcbõ7,0linebufñrmbõ256lineendñsetõ*ørmbõ128*4fpstackñsetõ*øendõmain